<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Aspiradores vs Fantasmas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* CRITICAL CSS - Carregado antes de tudo */
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #0f172a;
        touch-action: none;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      #root {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      /* OVERLAY DE LOADING */
      #loading-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: #0f172a;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.5s ease;
      }
      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255,255,255,0.1);
        border-radius: 50%;
        border-top-color: #3b82f6;
        animation: spin 1s ease-in-out infinite;
        margin-bottom: 24px;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      
      .loading-title {
          font-size: 24px;
          font-weight: 800;
          margin-bottom: 8px;
          text-transform: uppercase;
          letter-spacing: 1px;
      }
      .loading-text {
          font-size: 14px;
          color: #94a3b8;
          font-family: monospace;
      }

      /* PAINEL DE DEBUG (DEBUG_BOOT = true) */
      #debug-panel {
        display: none; /* Controlado via JS */
        position: fixed;
        bottom: 10px;
        right: 10px;
        width: 320px;
        background: rgba(0, 0, 0, 0.9);
        color: #00ff00;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #333;
        font-family: 'Consolas', monospace;
        font-size: 11px;
        z-index: 10000;
        pointer-events: none;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
      }
      .debug-header {
          border-bottom: 1px solid #333;
          margin-bottom: 8px;
          padding-bottom: 4px;
          font-weight: bold;
          color: #fff;
          display: flex;
          justify-content: space-between;
      }
      .debug-step { margin-bottom: 4px; display: flex; justify-content: space-between; }
      .debug-step.ok { color: #4ade80; }
      .debug-step.pending { color: #facc15; }
      .debug-step.error { color: #f87171; font-weight: bold; }
      
      /* Botão de Emergência */
      #force-start-btn {
          display: none;
          margin-top: 30px;
          padding: 12px 24px;
          background-color: #ef4444;
          color: white;
          border: 2px solid #f87171;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          font-size: 14px;
          text-transform: uppercase;
          box-shadow: 0 4px 10px rgba(220, 38, 38, 0.3);
          animation: pulse 2s infinite;
          z-index: 10001;
      }
      @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
    <script>
      // ======================================================
      // 1) CONFIGURAÇÃO DE DEBUG
      // ======================================================
      window.DEBUG_BOOT = true; // <--- FLAG GLOBAL DE DEBUG
      window.gameIsReady = false;

      // Utilitário de Log Seguro
      function bootLog(msg, type = 'info') {
        if (!window.DEBUG_BOOT) return;
        const prefix = "[BOOT DEBUG]";
        const timestamp = new Date().toISOString().split('T')[1].slice(0, -1);
        const fullMsg = `${prefix} [${timestamp}] ${msg}`;
        
        if (type === 'error') console.error(fullMsg);
        else console.log(fullMsg);
      }

      // Atualiza o painel visual
      window.reportBootStep = function(stepName, status) {
        if (!window.DEBUG_BOOT) return;
        
        const panel = document.getElementById('debug-panel');
        if (panel) {
            panel.style.display = 'block';
            let line = document.getElementById('step-' + stepName.replace(/\s+/g, '-'));
            
            if (!line) {
                line = document.createElement('div');
                line.id = 'step-' + stepName.replace(/\s+/g, '-');
                line.className = 'debug-step';
                document.getElementById('debug-content').appendChild(line);
            }
            
            let icon = status === 'OK' ? 'OK' : (status === 'ERROR' ? 'ERR' : '...');
            line.innerHTML = `<span>${stepName}</span> <span>[${icon}]</span>`;
            line.className = `debug-step ${status.toLowerCase()}`;
        }
        bootLog(`${stepName}: ${status}`, status === 'ERROR' ? 'error' : 'info');
      };

      // ======================================================
      // 2) FUNÇÃO DE FINALIZAÇÃO (Remove Loader)
      // ======================================================
      window.finishLoading = function() {
        if (window.gameIsReady) return;
        window.gameIsReady = true;
        
        window.reportBootStep('Loader Removal', 'OK');
        console.log("[BOOT] Removendo overlay de carregamento.");
        
        const loader = document.getElementById('loading-overlay');
        if (loader) {
            loader.style.opacity = '0';
            // Garante que o CSS não bloqueie clicks
            loader.style.pointerEvents = 'none';
            setTimeout(() => {
                loader.style.display = 'none';
            }, 500);
        }
      };

      // ======================================================
      // 3) LISTENER DE ERROS GLOBAIS
      // ======================================================
      window.onerror = function(msg, url, line, col, error) {
        // Ignora erros não críticos de ResizeObserver
        if (msg && typeof msg === 'string' && msg.includes('ResizeObserver')) return false;
        
        bootLog(`Erro Global: ${msg}`, 'error');
        window.reportBootStep('Global JS Runtime', 'ERROR');
        
        const statusEl = document.getElementById('loading-status');
        if (statusEl) {
            statusEl.innerText = "Erro detectado. Tentando recuperar...";
            statusEl.style.color = "#f87171";
        }
        
        // Em caso de erro, mostramos o botão de força bruta imediatamente
        const btn = document.getElementById('force-start-btn');
        if (btn) btn.style.display = 'block';
        
        return false;
      };

      // ======================================================
      // 4) INICIALIZAÇÃO DO DOM
      // ======================================================
      document.addEventListener("DOMContentLoaded", function() {
          window.reportBootStep('HTML DOM Loaded', 'OK');
          
          const root = document.getElementById('root');
          
          // Fallback: Polling para detectar React
          let checks = 0;
          const checkInterval = setInterval(() => {
              checks++;
              // Se o root tiver filhos, o React renderizou algo
              if (root && root.childElementCount > 0) {
                  window.reportBootStep('React Mount (Polling)', 'OK');
                  clearInterval(checkInterval);
                  // Pequeno delay para garantir que o render visual terminou
                  setTimeout(window.finishLoading, 100);
              }
              
              // Se passar 4 segundos e nada...
              if (checks > 16 && !window.gameIsReady) {
                  document.getElementById('loading-status').innerText = "Conexão lenta... finalizando...";
                  const btn = document.getElementById('force-start-btn');
                  if (btn) btn.style.display = 'block';
              }
          }, 250);
          
          // Handler do botão de emergência
          const btn = document.getElementById('force-start-btn');
          if(btn) btn.onclick = function() {
              bootLog("Usuário clicou em FORÇAR INÍCIO");
              window.finishLoading();
          };
      });
    </script>
    <script type="importmap">
    {
      "imports": {
        "react/": "https://aistudiocdn.com/react@^19.2.0/",
        "react": "https://aistudiocdn.com/react@^19.2.0",
        "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
        "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
      }
    }
    </script>
  </head>
  <body>
    <!-- Overlay de Loading -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-title">Aspiradores vs Fantasmas</div>
        <p id="loading-status" class="loading-text">Inicializando engine...</p>
        <button id="force-start-btn">⚠️ JOGAR AGORA (DEBUG)</button>
    </div>

    <!-- Painel de Debug -->
    <div id="debug-panel">
        <div class="debug-header">
            <span>BOOT DEBUG</span>
            <span>v1.2</span>
        </div>
        <div id="debug-content">
            <!-- Steps injetados via JS -->
        </div>
    </div>

    <div id="root"></div>
  </body>
</html>