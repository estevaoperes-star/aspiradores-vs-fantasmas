<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Aspiradores vs Fantasmas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* CRITICAL CSS */
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #0f172a;
        touch-action: none;
        font-family: sans-serif;
      }
      #root {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      #loading-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: #0f172a;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.5s ease;
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(255,255,255,0.3);
        border-radius: 50%;
        border-top-color: #3b82f6;
        animation: spin 1s ease-in-out infinite;
        margin-bottom: 20px;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      
      .loading-text {
          font-size: 14px;
          color: #94a3b8;
          margin-top: 10px;
          text-align: center;
          font-weight: bold;
      }

      /* Botão de Emergência (Force Start) */
      #force-start-btn {
          display: none; /* Invisível por padrão */
          margin-top: 25px;
          padding: 14px 28px;
          background-color: #22c55e;
          color: white;
          border: none;
          border-radius: 12px;
          font-weight: 800;
          font-size: 16px;
          cursor: pointer;
          box-shadow: 0 4px 0 #15803d;
          animation: pulse 2s infinite;
          text-transform: uppercase;
          letter-spacing: 1px;
      }
      #force-start-btn:active {
          transform: translateY(4px);
          box-shadow: none;
      }
      @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
    <script>
      // 1. Função Global de Liberação (Acessível pelo React)
      window.gameIsReady = false;
      
      window.finishLoading = function() {
          if (window.gameIsReady) return;
          window.gameIsReady = true;
          
          console.log("[BOOT] Jogo sinalizou prontidão.");
          const loader = document.getElementById('loading-overlay');
          if (loader) {
              loader.style.opacity = '0';
              setTimeout(() => {
                  loader.style.display = 'none';
              }, 500);
          }
      };

      // 2. Listener de Erros Globais (Não trava o load, apenas loga)
      window.onerror = function(msg, url, line, col, error) {
        // Ignora erros comuns de ResizeObserver
        if (msg && typeof msg === 'string' && msg.includes('ResizeObserver')) return false;
        console.warn("[BOOT ERROR]", msg);
        // Em caso de erro, força o load após breve delay para não travar o usuário
        setTimeout(window.finishLoading, 2000); 
        return false;
      };

      document.addEventListener("DOMContentLoaded", function() {
          console.log("[BOOT] DOM carregado. Iniciando monitoramento...");
          const root = document.getElementById('root');
          const btn = document.getElementById('force-start-btn');
          const status = document.getElementById('loading-status');
          
          // 3. Monitoramento Passivo (Polling)
          // Verifica a cada 250ms se o React injetou algo no #root
          const checkInterval = setInterval(() => {
              if (root && root.childElementCount > 0) {
                  console.log("[BOOT] Conteúdo detectado no #root. Liberando overlay.");
                  clearInterval(checkInterval);
                  window.finishLoading();
              }
          }, 250);

          // 4. Timer de Segurança (Mostra botão após 5 segundos)
          setTimeout(() => {
              if (!window.gameIsReady && document.getElementById('loading-overlay').style.display !== 'none') {
                  console.warn("[BOOT] Carregamento lento detectado. Habilitando botão manual.");
                  if(status) status.innerText = "O carregamento está demorando...";
                  if(btn) {
                      btn.style.display = 'block';
                      btn.onclick = function() {
                          console.log("[BOOT] Force Start clicado.");
                          window.finishLoading();
                      };
                  }
              }
          }, 5000);

          // 5. Fallback Final (15 segundos - Remove overlay à força)
          setTimeout(() => {
             if (!window.gameIsReady && document.getElementById('loading-overlay').style.display !== 'none') {
                 console.error("[BOOT] Timeout limite atingido. Removendo overlay forçadamente.");
                 window.finishLoading();
             }
          }, 15000);
      });
    </script>
    <script type="importmap">
    {
      "imports": {
        "react/": "https://aistudiocdn.com/react@^19.2.0/",
        "react": "https://aistudiocdn.com/react@^19.2.0",
        "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
        "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
      }
    }
    </script>
  </head>
  <body>
    <div id="loading-overlay">
        <div class="spinner"></div>
        <h2 style="font-weight:bold; font-size: 20px; margin-bottom: 5px;">Aspiradores vs Fantasmas</h2>
        <p id="loading-status" class="loading-text">Organizando a casa...</p>
        <button id="force-start-btn">JOGAR AGORA</button>
    </div>
    <div id="root"></div>
  </body>
</html>